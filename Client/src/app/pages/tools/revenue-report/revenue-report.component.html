<div class="revenue-report-container">
  <nz-card nzTitle="Báo cáo tổng hợp doanh thu">
    <!-- Filter Section -->
    <div class="filter-section">
      <div nz-row [nzGutter]="16">
        <!-- Ngày -->
        <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="6">
          <nz-range-picker
            [(ngModel)]="filterDateRange"
            nzFormat="yyyy-MM-dd"
            style="width: 100%"
            nzPlaceHolder="['Từ ngày', 'Đến ngày']">
          </nz-range-picker>
        </div>

        <!-- Lễ tân -->
        <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="5">
          <nz-input-group nzSearch>
            <input
              type="text"
              nz-input
              placeholder="Lọc theo lễ tân"
              [(ngModel)]="filterReceptionist" />
          </nz-input-group>
        </div>

        <!-- Loại ca -->
        <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="4">
          <nz-select
            nzShowSearch
            nzAllowClear
            nzPlaceHolder="Loại ca"
            [(ngModel)]="filterShiftType"
            style="width: 100%">
            <nz-option
              *ngFor="let type of shiftTypes"
              [nzLabel]="type"
              [nzValue]="type">
            </nz-option>
          </nz-select>
        </div>

        <!-- Số phòng -->
        <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="4">
          <input
            nz-input
            placeholder="Số phòng"
            [(ngModel)]="filterRoomNumber" />
        </div>

        <!-- Nút hành động -->
        <div
          nz-col
          [nzXs]="24"
          [nzSm]="24"
          [nzMd]="24"
          [nzLg]="5"
          style="display: flex; flex-wrap: wrap; gap: 8px">
          <button
            nz-button
            nzType="primary"
            (click)="loadReport()"
            [nzLoading]="isLoading"
            style="flex: 1 1 auto">
            <span nz-icon nzType="search"></span>
            Xem
          </button>

          <button nz-button (click)="resetFilters()" style="flex: 1 1 auto">
            <span nz-icon nzType="reload"></span>
            Làm mới
          </button>
        </div>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="summary-section" *ngIf="reportData">
      <div nz-row [nzGutter]="16">
        <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="12" [nzLg]="6">
          <nz-card>
            <nz-statistic
              [nzValue]="formatCurrency(reportData.Summary.TotalRevenue)"
              nzTitle="Tổng doanh thu"
              [nzPrefix]="prefixTpl"
              nzSuffix="đ"
              [nzValueStyle]="{ color: '#3f8600' }">
            </nz-statistic>
            <ng-template #prefixTpl>
              <span nz-icon nzType="dollar" nzTheme="outline"></span>
            </ng-template>
          </nz-card>
        </div>

        <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="12" [nzLg]="6">
          <nz-card>
            <nz-statistic
              [nzValue]="formatCurrency(reportData.Summary.TotalCash)"
              nzTitle="Tiền mặt"
              nzSuffix="đ"
              [nzValueStyle]="{ color: '#1890ff' }">
            </nz-statistic>
          </nz-card>
        </div>

        <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="12" [nzLg]="6">
          <nz-card>
            <nz-statistic
              [nzValue]="formatCurrency(reportData.Summary.TotalTransfer)"
              nzTitle="Chuyển khoản"
              nzSuffix="đ"
              [nzValueStyle]="{ color: '#722ed1' }">
            </nz-statistic>
          </nz-card>
        </div>

        <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="12" [nzLg]="6">
          <nz-card>
            <nz-statistic
              [nzValue]="formatCurrency(reportData.Summary.TotalExpense)"
              nzTitle="Tổng chi tiêu"
              nzSuffix="đ"
              [nzValueStyle]="{ color: '#cf1322' }">
            </nz-statistic>
          </nz-card>
        </div>
      </div>

      <!-- Hàng thứ hai -->
      <div nz-row [nzGutter]="16" style="margin-top: 16px">
        <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="12" [nzLg]="8">
          <nz-card>
            <nz-statistic
              [nzValue]="formatCurrency(reportData.Summary.NetRevenue)"
              nzTitle="Doanh thu thuần"
              nzSuffix="đ"
              [nzValueStyle]="{ color: '#52c41a', fontWeight: 'bold' }">
            </nz-statistic>
          </nz-card>
        </div>

        <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="12" [nzLg]="8">
          <nz-card>
            <nz-statistic
              [nzValue]="formatCurrency(reportData.Summary.TotalShifts)"
              nzTitle="Số ca làm việc"
              nzSuffix="ca">
            </nz-statistic>
          </nz-card>
        </div>

        <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="12" [nzLg]="8">
          <nz-card>
            <nz-statistic
              [nzValue]="formatCurrency(reportData.Summary.TotalTransactions)"
              nzTitle="Số giao dịch"
              nzSuffix="giao dịch">
            </nz-statistic>
          </nz-card>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <nz-divider nzText="Biểu đồ phân tích"></nz-divider>

    <div class="charts-section" *ngIf="reportData">
      <nz-tabset>
        <nz-tab nzTitle="Doanh thu theo ngày">
          <nz-card nzTitle="Doanh thu theo ngày">
            <div class="table-container">
              <nz-table
                [nzData]="reportData.RevenueByDate"
                [nzShowPagination]="false"
                nzSize="small">
                <thead>
                  <tr>
                    <th>Ngày</th>
                    <th nzAlign="right">Tiền mặt</th>
                    <th nzAlign="right">Chuyển khoản</th>
                    <th nzAlign="right">Chi tiêu</th>
                    <th nzAlign="right">Tổng doanh thu</th>
                    <th nzAlign="center">Số ca</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of reportData.RevenueByDate">
                    <td>{{ item.Date | date: 'yyyy-MM-dd' }}</td>
                    <td nzAlign="right">
                      {{ item.TotalCash | number: '1.0-0' }}
                    </td>
                    <td nzAlign="right">
                      {{ item.TotalTransfer | number: '1.0-0' }}
                    </td>
                    <td nzAlign="right">
                      {{ item.TotalExpense | number: '1.0-0' }}
                    </td>
                    <td nzAlign="right">
                      <strong>{{ item.TotalRevenue | number: '1.0-0' }}</strong>
                    </td>
                    <td nzAlign="center">{{ item.ShiftCount }}</td>
                  </tr>
                </tbody>
              </nz-table>
            </div>
          </nz-card>
        </nz-tab>

        <nz-tab nzTitle="Theo loại ca">
          <nz-card nzTitle="Doanh thu theo loại ca">
            <nz-table
              [nzData]="reportData.RevenueByShiftType"
              [nzShowPagination]="false"
              nzSize="small">
              <thead>
                <tr>
                  <th>Loại ca</th>
                  <th nzAlign="right">Tiền mặt</th>
                  <th nzAlign="right">Chuyển khoản</th>
                  <th nzAlign="right">Tổng doanh thu</th>
                  <th nzAlign="center">Số ca</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of reportData.RevenueByShiftType">
                  <td>
                    <nz-tag
                      [nzColor]="
                        item.ShiftType === 'Ca ngày' ? 'blue' : 'purple'
                      ">
                      {{ item.ShiftType }}
                    </nz-tag>
                  </td>
                  <td nzAlign="right">
                    {{ item.TotalCash | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    {{ item.TotalTransfer | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    <strong>{{ item.TotalRevenue | number: '1.0-0' }}</strong>
                  </td>
                  <td nzAlign="center">{{ item.ShiftCount }}</td>
                </tr>
              </tbody>
            </nz-table>
          </nz-card>
        </nz-tab>

        <nz-tab nzTitle="Theo lễ tân">
          <nz-card nzTitle="Doanh thu theo lễ tân">
            <nz-table
              [nzData]="reportData.RevenueByReceptionist"
              [nzShowPagination]="false"
              nzSize="small">
              <thead>
                <tr>
                  <th>Lễ tân</th>
                  <th nzAlign="right">Tiền mặt</th>
                  <th nzAlign="right">Chuyển khoản</th>
                  <th nzAlign="right">Tổng doanh thu</th>
                  <th nzAlign="center">Số ca</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of reportData.RevenueByReceptionist">
                  <td>
                    <strong>{{ item.ReceptionistName }}</strong>
                  </td>
                  <td nzAlign="right">
                    {{ item.TotalCash | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    {{ item.TotalTransfer | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    <strong>{{ item.TotalRevenue | number: '1.0-0' }}</strong>
                  </td>
                  <td nzAlign="center">{{ item.ShiftCount }}</td>
                </tr>
              </tbody>
            </nz-table>
          </nz-card>
        </nz-tab>

        <nz-tab nzTitle="Theo phòng">
          <nz-card nzTitle="Doanh thu theo phòng">
            <nz-table
              [nzData]="reportData.RevenueByRoom"
              [nzShowPagination]="false"
              nzSize="small"
              [nzScroll]="{ y: '400px' }">
              <thead>
                <tr>
                  <th>Số phòng</th>
                  <th nzAlign="right">Tiền mặt</th>
                  <th nzAlign="right">Chuyển khoản</th>
                  <th nzAlign="right">Tổng doanh thu</th>
                  <th nzAlign="center">Số giao dịch</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of reportData.RevenueByRoom">
                  <td>
                    <nz-tag nzColor="green">{{ item.RoomNumber }}</nz-tag>
                  </td>
                  <td nzAlign="right">
                    {{ item.TotalCash | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    {{ item.TotalTransfer | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    <strong>{{ item.TotalRevenue | number: '1.0-0' }}</strong>
                  </td>
                  <td nzAlign="center">{{ item.TransactionCount }}</td>
                </tr>
              </tbody>
            </nz-table>
          </nz-card>
        </nz-tab>

        <nz-tab nzTitle="Chi tiết các ca">
          <nz-card nzTitle="Chi tiết các ca làm việc">
            <nz-table
              [nzData]="reportData.Details"
              [nzShowPagination]="true"
              [nzPageSize]="10"
              nzSize="small">
              <thead>
                <tr>
                  <th>Ngày ca</th>
                  <th>Loại ca</th>
                  <th>Lễ tân</th>
                  <th nzAlign="right">Tiền mặt</th>
                  <th nzAlign="right">Chuyển khoản</th>
                  <th nzAlign="right">Bàn giao</th>
                  <th>Ngày tạo</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of reportData.Details">
                  <td>{{ item.ShiftDate | date: 'yyyy-MM-dd' }}</td>
                  <td>
                    <nz-tag
                      [nzColor]="
                        item.ShiftType === 'Ca ngày' ? 'blue' : 'purple'
                      ">
                      {{ item.ShiftType }}
                    </nz-tag>
                  </td>
                  <td>{{ item.ReceptionistName }}</td>
                  <td nzAlign="right">
                    {{ item.TotalCash | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    {{ item.TotalTransfer | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    {{ item.HandoverAmount | number: '1.0-0' }}
                  </td>
                  <td>{{ item.CreatedDTime | date: 'yyyy-MM-dd HH:mm' }}</td>
                </tr>
              </tbody>
            </nz-table>
          </nz-card>
        </nz-tab>
      </nz-tabset>
    </div>

    <!-- Empty State -->
    <nz-empty
      *ngIf="!reportData && !isLoading"
      nzNotFoundContent="Chưa có dữ liệu báo cáo"></nz-empty>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
    </div>
  </nz-card>
</div>
