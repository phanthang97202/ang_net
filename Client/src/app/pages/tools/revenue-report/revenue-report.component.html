<div class="revenue-report-container">
  <nz-card nzTitle="Báo cáo tổng hợp doanh thu">
    <!-- Filter Section -->
    <div class="filter-section">
      <div nz-row [nzGutter]="16">
        <div nz-col [nzSpan]="6">
          <nz-range-picker
            [(ngModel)]="filterDateRange"
            nzFormat="dd/MM/yyyy"
            style="width: 100%"
            nzPlaceHolder="['Từ ngày', 'Đến ngày']"></nz-range-picker>
        </div>

        <div nz-col [nzSpan]="5">
          <nz-input-group nzSearch>
            <input
              type="text"
              nz-input
              placeholder="Lọc theo lễ tân"
              [(ngModel)]="filterReceptionist" />
          </nz-input-group>
        </div>

        <div nz-col [nzSpan]="4">
          <nz-select
            nzShowSearch
            nzAllowClear
            nzPlaceHolder="Loại ca"
            [(ngModel)]="filterShiftType"
            style="width: 100%">
            <nz-option
              *ngFor="let type of shiftTypes"
              [nzLabel]="type"
              [nzValue]="type"></nz-option>
          </nz-select>
        </div>

        <div nz-col [nzSpan]="4">
          <input
            nz-input
            placeholder="Số phòng"
            [(ngModel)]="filterRoomNumber" />
        </div>

        <div nz-col [nzSpan]="5">
          <button
            nz-button
            nzType="primary"
            (click)="loadReport()"
            [nzLoading]="isLoading">
            <span nz-icon nzType="search"></span>
            Xem báo cáo
          </button>
          <button nz-button (click)="resetFilters()" style="margin-left: 8px">
            <span nz-icon nzType="reload"></span>
            Làm mới
          </button>
        </div>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="summary-section" *ngIf="reportData">
      <div nz-row [nzGutter]="16">
        <div nz-col [nzSpan]="6">
          <nz-card>
            <nz-statistic
              [nzValue]="reportData.summary.totalRevenue"
              [nzTitle]="'Tổng doanh thu'"
              [nzPrefix]="prefixTpl"
              [nzSuffix]="'đ'"
              [nzValueStyle]="{ color: '#3f8600' }"></nz-statistic>
            <ng-template #prefixTpl>
              <span nz-icon nzType="dollar" nzTheme="outline"></span>
            </ng-template>
          </nz-card>
        </div>

        <div nz-col [nzSpan]="6">
          <nz-card>
            <nz-statistic
              [nzValue]="reportData.summary.totalCash"
              [nzTitle]="'Tiền mặt'"
              [nzSuffix]="'đ'"
              [nzValueStyle]="{ color: '#1890ff' }"></nz-statistic>
          </nz-card>
        </div>

        <div nz-col [nzSpan]="6">
          <nz-card>
            <nz-statistic
              [nzValue]="reportData.summary.totalTransfer"
              [nzTitle]="'Chuyển khoản'"
              [nzSuffix]="'đ'"
              [nzValueStyle]="{ color: '#722ed1' }"></nz-statistic>
          </nz-card>
        </div>

        <div nz-col [nzSpan]="6">
          <nz-card>
            <nz-statistic
              [nzValue]="reportData.summary.totalExpense"
              [nzTitle]="'Tổng chi tiêu'"
              [nzSuffix]="'đ'"
              [nzValueStyle]="{ color: '#cf1322' }"></nz-statistic>
          </nz-card>
        </div>
      </div>

      <div nz-row [nzGutter]="16" style="margin-top: 16px">
        <div nz-col [nzSpan]="8">
          <nz-card>
            <nz-statistic
              [nzValue]="reportData.summary.netRevenue"
              [nzTitle]="'Doanh thu thuần'"
              [nzSuffix]="'đ'"
              [nzValueStyle]="{
                color: '#52c41a',
                fontWeight: 'bold',
              }"></nz-statistic>
          </nz-card>
        </div>

        <div nz-col [nzSpan]="8">
          <nz-card>
            <nz-statistic
              [nzValue]="reportData.summary.totalShifts"
              [nzTitle]="'Số ca làm việc'"
              [nzSuffix]="'ca'"></nz-statistic>
          </nz-card>
        </div>

        <div nz-col [nzSpan]="8">
          <nz-card>
            <nz-statistic
              [nzValue]="reportData.summary.totalTransactions"
              [nzTitle]="'Số giao dịch'"
              [nzSuffix]="'giao dịch'"></nz-statistic>
          </nz-card>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <nz-divider nzText="Biểu đồ phân tích"></nz-divider>

    <div class="charts-section" *ngIf="reportData">
      <nz-tabset>
        <nz-tab nzTitle="Doanh thu theo ngày">
          <nz-card nzTitle="Doanh thu theo ngày">
            <div class="table-container">
              <nz-table
                [nzData]="reportData.revenueByDate"
                [nzShowPagination]="false"
                nzSize="small">
                <thead>
                  <tr>
                    <th>Ngày</th>
                    <th nzAlign="right">Tiền mặt</th>
                    <th nzAlign="right">Chuyển khoản</th>
                    <th nzAlign="right">Chi tiêu</th>
                    <th nzAlign="right">Tổng doanh thu</th>
                    <th nzAlign="center">Số ca</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of reportData.revenueByDate">
                    <td>{{ item.date | date: 'dd/MM/yyyy' }}</td>
                    <td nzAlign="right">
                      {{ item.totalCash | number: '1.0-0' }}
                    </td>
                    <td nzAlign="right">
                      {{ item.totalTransfer | number: '1.0-0' }}
                    </td>
                    <td nzAlign="right">
                      {{ item.totalExpense | number: '1.0-0' }}
                    </td>
                    <td nzAlign="right">
                      <strong>{{ item.totalRevenue | number: '1.0-0' }}</strong>
                    </td>
                    <td nzAlign="center">{{ item.shiftCount }}</td>
                  </tr>
                </tbody>
              </nz-table>
            </div>
          </nz-card>
        </nz-tab>

        <nz-tab nzTitle="Theo loại ca">
          <nz-card nzTitle="Doanh thu theo loại ca">
            <nz-table
              [nzData]="reportData.revenueByShiftType"
              [nzShowPagination]="false"
              nzSize="small">
              <thead>
                <tr>
                  <th>Loại ca</th>
                  <th nzAlign="right">Tiền mặt</th>
                  <th nzAlign="right">Chuyển khoản</th>
                  <th nzAlign="right">Tổng doanh thu</th>
                  <th nzAlign="center">Số ca</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of reportData.revenueByShiftType">
                  <td>
                    <nz-tag
                      [nzColor]="
                        item.shiftType === 'Ca ngày' ? 'blue' : 'purple'
                      ">
                      {{ item.shiftType }}
                    </nz-tag>
                  </td>
                  <td nzAlign="right">
                    {{ item.totalCash | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    {{ item.totalTransfer | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    <strong>{{ item.totalRevenue | number: '1.0-0' }}</strong>
                  </td>
                  <td nzAlign="center">{{ item.shiftCount }}</td>
                </tr>
              </tbody>
            </nz-table>
          </nz-card>
        </nz-tab>

        <nz-tab nzTitle="Theo lễ tân">
          <nz-card nzTitle="Doanh thu theo lễ tân">
            <nz-table
              [nzData]="reportData.revenueByReceptionist"
              [nzShowPagination]="false"
              nzSize="small">
              <thead>
                <tr>
                  <th>Lễ tân</th>
                  <th nzAlign="right">Tiền mặt</th>
                  <th nzAlign="right">Chuyển khoản</th>
                  <th nzAlign="right">Tổng doanh thu</th>
                  <th nzAlign="center">Số ca</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of reportData.revenueByReceptionist">
                  <td>
                    <strong>{{ item.receptionistName }}</strong>
                  </td>
                  <td nzAlign="right">
                    {{ item.totalCash | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    {{ item.totalTransfer | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    <strong>{{ item.totalRevenue | number: '1.0-0' }}</strong>
                  </td>
                  <td nzAlign="center">{{ item.shiftCount }}</td>
                </tr>
              </tbody>
            </nz-table>
          </nz-card>
        </nz-tab>

        <nz-tab nzTitle="Theo phòng">
          <nz-card nzTitle="Doanh thu theo phòng">
            <nz-table
              [nzData]="reportData.revenueByRoom"
              [nzShowPagination]="false"
              nzSize="small"
              [nzScroll]="{ y: '400px' }">
              <thead>
                <tr>
                  <th>Số phòng</th>
                  <th nzAlign="right">Tiền mặt</th>
                  <th nzAlign="right">Chuyển khoản</th>
                  <th nzAlign="right">Tổng doanh thu</th>
                  <th nzAlign="center">Số giao dịch</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of reportData.revenueByRoom">
                  <td>
                    <nz-tag nzColor="green">{{ item.roomNumber }}</nz-tag>
                  </td>
                  <td nzAlign="right">
                    {{ item.totalCash | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    {{ item.totalTransfer | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    <strong>{{ item.totalRevenue | number: '1.0-0' }}</strong>
                  </td>
                  <td nzAlign="center">{{ item.transactionCount }}</td>
                </tr>
              </tbody>
            </nz-table>
          </nz-card>
        </nz-tab>

        <nz-tab nzTitle="Chi tiết các ca">
          <nz-card nzTitle="Chi tiết các ca làm việc">
            <nz-table
              [nzData]="reportData.details"
              [nzShowPagination]="true"
              [nzPageSize]="10"
              nzSize="small">
              <thead>
                <tr>
                  <th>Ngày ca</th>
                  <th>Loại ca</th>
                  <th>Lễ tân</th>
                  <th nzAlign="right">Tiền mặt</th>
                  <th nzAlign="right">Chuyển khoản</th>
                  <th nzAlign="right">Bàn giao</th>
                  <th>Ngày tạo</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of reportData.details">
                  <td>{{ item.shiftDate | date: 'dd/MM/yyyy' }}</td>
                  <td>
                    <nz-tag
                      [nzColor]="
                        item.shiftType === 'Ca ngày' ? 'blue' : 'purple'
                      ">
                      {{ item.shiftType }}
                    </nz-tag>
                  </td>
                  <td>{{ item.receptionistName }}</td>
                  <td nzAlign="right">
                    {{ item.totalCash | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    {{ item.totalTransfer | number: '1.0-0' }}
                  </td>
                  <td nzAlign="right">
                    {{ item.handoverAmount | number: '1.0-0' }}
                  </td>
                  <td>{{ item.createdAt | date: 'dd/MM/yyyy HH:mm' }}</td>
                </tr>
              </tbody>
            </nz-table>
          </nz-card>
        </nz-tab>
      </nz-tabset>
    </div>

    <!-- Empty State -->
    <nz-empty
      *ngIf="!reportData && !isLoading"
      nzNotFoundContent="Chưa có dữ liệu báo cáo"></nz-empty>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
    </div>
  </nz-card>
</div>
